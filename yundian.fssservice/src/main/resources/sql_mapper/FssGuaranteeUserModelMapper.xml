<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yundian.fss.dao.FssGuaranteeUserModelMapper">
  <resultMap id="BaseResultMap" type="com.yundian.fssapi.domain.FssGuaranteeUserModel">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="user_id" jdbcType="BIGINT" property="userId" />
    <result column="guarantee_id" jdbcType="INTEGER" property="guaranteeId" />
    <result column="role_id" jdbcType="VARCHAR" property="roleId" />
	<result column="is_default_guarantee" jdbcType="VARCHAR" property="isDefaultGuarantee" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="sex" jdbcType="INTEGER" property="sex" />
    <result column="tel" jdbcType="VARCHAR" property="tel" />
    <result column="station" jdbcType="VARCHAR" property="station" />
    <result column="region" jdbcType="VARCHAR" property="region" />
    <result column="ctime" jdbcType="TIMESTAMP" property="ctime" />
    <result column="mtime" jdbcType="TIMESTAMP" property="mtime" />
    <result column="remark" jdbcType="VARCHAR" property="remark" />
  </resultMap>
  
  <resultMap id="FssGuaranteeUserQueryResultMap" type="com.yundian.fssapi.domain.query.FssGuaranteeUserQueryModel">
  	<!-- 担保机构部分 -->
  	<result column="guarantee_id" jdbcType="INTEGER" property="guaranteeId" />
	<result column="guarantee_name" jdbcType="VARCHAR" property="guaranteeName" />
	<result column="guarantee_code" jdbcType="VARCHAR" property="guaranteeCode" />
	<result column="contactor" jdbcType="VARCHAR" property="contactor" />
	<result column="phone" jdbcType="VARCHAR" property="phone" />
	<result column="businessentity" jdbcType="VARCHAR" property="businessentity" />
	<result column="organize_code" jdbcType="VARCHAR" property="organizeCode" />
	<result column="license_code" jdbcType="VARCHAR" property="licenseCode" />
	<result column="province" jdbcType="INTEGER" property="province" />
	<result column="city" jdbcType="INTEGER" property="city" />
	<result column="area" jdbcType="INTEGER" property="area" />
	<result column="province_name" jdbcType="VARCHAR" property="provinceName" />
	<result column="city_name" jdbcType="VARCHAR" property="cityName" />
	<result column="area_name" jdbcType="VARCHAR" property="areaName" />
	<result column="street" jdbcType="VARCHAR" property="street" />
	<result column="verify_status" jdbcType="VARCHAR" property="verifyStatus" />
	<result column="verify_time" jdbcType="TIMESTAMP" property="verifyTime" />
	<result column="ctime" jdbcType="TIMESTAMP" property="ctime" />
	<result column="mtime" jdbcType="TIMESTAMP" property="mtime" />
	<result column="remark" jdbcType="VARCHAR" property="remark" />
	<!-- 用户部分 -->
	<result column="is_default_guarantee" jdbcType="VARCHAR" property="isDefaultGuarantee" />
	<result column="user_id" jdbcType="INTEGER" property="userId" />
	<result column="role_id" jdbcType="VARCHAR" property="roleId" />
	<result column="station" jdbcType="VARCHAR" property="station" />
   	<result column="region" jdbcType="VARCHAR" property="region" />
  </resultMap>
  
  
  <sql id="Base_Column_List">
    id, 
    user_id, 
    guarantee_id,
    is_default_guarantee, 
    role_id, 
    name, 
    sex, 
    tel, 
    station, 
    region, 
    ctime, 
    mtime, 
    remark
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    select 
    <include refid="Base_Column_List" />
    from fss_guarantee_user
    where id = #{id,jdbcType=BIGINT}
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    delete from fss_guarantee_user
    where id = #{id,jdbcType=BIGINT}
  </delete>
  
  <insert id="insert" parameterType="com.yundian.fssapi.domain.FssGuaranteeUserModel">
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Long">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into fss_guarantee_user 
    (
    	user_id, 
    	guarantee_id, 
    	is_default_guarantee,
    	role_id, 
      	name, 
      	sex, 
      	tel, 
      	station, 
	    region, 
	    ctime, 
	    remark
     )
    values 
    (
    	#{userId,jdbcType=BIGINT}, 
    	#{guaranteeId,jdbcType=INTEGER}, 
    	#{isDefaultGuarantee,jdbcType=VARCHAR}, 
    	#{roleId,jdbcType=VARCHAR}, 
      	#{name,jdbcType=VARCHAR}, 
      	#{sex,jdbcType=INTEGER}, 
      	#{tel,jdbcType=VARCHAR}, 
      	#{station,jdbcType=VARCHAR}, 
      	#{region,jdbcType=VARCHAR}, 
      	now(),
      	#{remark,jdbcType=VARCHAR}
     )
  </insert>
 
  <update id="updateByPrimaryByUserIdAndGuaranteeId" parameterType="com.yundian.fssapi.domain.FssGuaranteeUserModel">
    update fss_guarantee_user
     set 
      role_id = #{roleId,jdbcType=VARCHAR},
      name = #{name,jdbcType=VARCHAR},
      sex = #{sex,jdbcType=INTEGER},
      tel = #{tel,jdbcType=VARCHAR},
      station = #{station,jdbcType=VARCHAR},
      region = #{region,jdbcType=VARCHAR},
      mtime = now(),
      remark = #{remark,jdbcType=VARCHAR}
      where user_id = #{userId,jdbcType=BIGINT}
      and guarantee_id = #{guaranteeId,jdbcType=INTEGER}
  </update>
  
  <select id="getGuaranteeUserQueryListByUserId" parameterType="java.lang.Integer"
		resultMap="FssGuaranteeUserQueryResultMap">
		select  
		t1.guarantee_id, 
		t1.guarantee_name, 
		t1.guarantee_code, 
		t1.contactor, 
		t1.phone, 
		t1.businessentity,
		t1.organize_code,
		t1.license_code, 
		t1.province, 
		t1.city, 
		t1.area,
		t1.province_name, 
		t1.city_name, 
		t1.area_name,  
		t1.street, 
		t1.verify_status, 
		t1.verify_time,
		
		t2.is_default_guarantee,
		t2.user_id,
		t2.role_id,
		t2.station,
		t2.region
		
		from fss_guarantee t1
		left join fss_guarantee_user t2 on t1.guarantee_id=t2.guarantee_id
		left join fss_user t3 on t3.user_id=t2.user_id
		where t3.user_id=#{userId}
	</select>
	
	<select id="getGuaranteeUserCountByGuaranteeId" resultType="int" parameterType="long">
		select count(*)  from fss_guarantee_user  where guarantee_id=#{guaranteeId}
	</select>
</mapper>